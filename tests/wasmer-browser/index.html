<script type="module">
  import { init, Wasmer } from "@wasmer/sdk";
  await init();

  const response = await fetch("./out/typst-community-hayagriva.webc")
  const buffer = await response.arrayBuffer()
  const bytes = new Uint8Array(buffer)
  console.log("fetched response", { response, buffer, bytes })

  const pkg = await Wasmer.fromFile(bytes)
  console.log("loaded package", { pkg })

  const instance = await pkg.entrypoint.run({
      mount: {
        "/wasmer": {
          "literature.yml": `\
dependence:
    type: Article
    title: The program dependence graph and its use in optimization
    author: ["Ferrante, Jeanne", "Ottenstein, Karl J.", "Warren, Joe D."]
    date: 1987-07
    serial-number:
        doi: "10.1145/24039.24041"
    parent:
        type: Periodical
        title: ACM Transactions on Programming Languages and Systems
        volume: 9
        issue: 3

feminism:
    type: Article
    title: She swoons to conquer
    author: Ungard-Sargon, Batya
    editor: Weintraub, Pam
    date: 2015-09-25
    url: https://aeon.co/essays/can-you-enjoy-romance-fiction-and-be-a-feminist
    parent:
        type: Blog
        title: Aeon
`
        }
      },
      args: ["/wasmer/literature.yml", "reference", "--style=apa"],
  });
  console.log("loaded instance", { instance })

  const { code, stdout } = await instance.wait();
  console.log("completed", { code, stdout })
</script>
